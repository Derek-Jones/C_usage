Data used to generate the graphs/tables in my book [The New C Standard: An Economic and Cultural Commentary](http://www.knosof.co.uk/cbook/cbook.html), along with the scripts and source code used to create the data.

[Blog post](https://shape-of-code.com/2025/09/28/datacode-for-book-the-new-c-standard/) discussing the background.

The original data is contained in the _diagrams_ directory.  The mapping from a graph/table in the book to the corresponding data filename is somewhat involved (these generated files were automatically inserted into the text of the book, which was then processed using various tools to generate a pdf file).

So you've seen a plot and you want the numbers used to create the plot.  The process to locate the appropriate data file is as follows:

- Paste the first few words of the plot's caption, e.g., the caption for Figure 825.1 starts: "Number of integer constants"

- Open the file _graph-table.txt_ and search for these words,

- The name appearing above the caption (_freqcons_ in this example above) is the name of the .gra file containing the commands used to create the plot (in the _grap_ language),

- Go to the _diagrams_ directory and open the .gra file (e.g., _freqcons.gra_),

- Locate the copy commands (e.g., `copy "intlitvals.d" thru {`), and note the name(s) of the data file (in this example _intlitvals.d_).  The data is in this file.

The process of extracting data from a collection of C projects is as follows:

* Put the source, or links to the source, in the programs directory.  This currently contains tar/zip files of the projects measured for the book.

* The data is extracted from .c and .f files by the program _ngram_.  Various scripts are available to process the output of ngram to produce graphs (_mkallgra.sh_) and tables (_mkalltab.sh_).

Some of the figures and tables use data generated using commercially available tools which are not included in this package.

The graphs are created using _grap_.  This tool is part of the groff/pic/tbl family, but is not packaged with many Linux distributions.  You can download it from: 
https://www.lunabase.org/~faber/Vault/software/grap or
https://github.com/snorerot13/grap

The file _config.files_ sets various shell variables.  The variable _USE_HOME_ needs to be set to the directory that contains this file

The top level script _mkallget.sh_ invokes the scripts that execute ngram with various arguments.  This generates various raw data files from the source code.  Some of this raw data may need to be processed again (generating other data files) before it is a suitable final form.  Setting _GEN_DATA_ (in config.files) to 0 stops mkallgra.sh and mkalltab.sh generating these data files, but they continue to do everything else they do (this saves time when tuning the formatting of the graphs and tables).

There are data extraction scripts in various directories (these are invariably called _getxxxx.sh_, where _xxxx_ is a name relating to the data they extract).  The _mkgra.sh_ script in each directory extracts the necessary data (creating .d files) and expand the .g files (to .gra files).  The _mktab.sh_ script in each directory extracts the necessary data and writes it to a text file (one file per table).

Starting with a new set of source files available in the directory program the commands to execute are:

- Compile two programs and copy them to a few subdirectories using:

    `bldall.sh`

- Extract the data:

    `c_use.sh > c.cnt`  
    `h_use.sh > h.cnt`  
    `mkallget.sh`  
    `mkallgra.sh`  
    `mkalltab.sh`

- To generate postscript and pdf files for the contents of the diagrams directory (placed in the _ps_ directory), assuming you have installed _grap_, use:

    `cd ../diagrams`  
    `mkps.sh`

The distributed directories are:

* _program_: The default directory used for finding .c and .h files. The top level directories in program are assumed to denote various applications, or groups of programs.  This directory can simply consist of links to where the source is actually held.

- _idents_: Identifier related data and scripts.  By default the various Levenstein distance measurements are not generated. It takes 4+ hours, on a 1.5GHz Pentium, to generate the measurements for _gcc_ (it is an N^2 algorithm).  Edit _getall.sh_ to change this default.

- _prepro_: Preprocessor related data and scripts.

- _statements_: Statement related data and scripts.  It takes 3+ hours, on a 1.5GHz Pentium, to generate all the raw data for _gcc_.

- _decls_: Declaration related data and scripts.

- _tables_: Scripts for extracting data from various ngram generated files.  Numbers are designed to appear in tables.

- _duplicates_: Duplicate lines are detected using _simian_. A full evaluation version of this tool can be downloaded from
	      [www.redhillconsulting.com.au/products/simian](https://www.freshports.org/devel/simian/)

- _bldgra_: Build .gra and .d files from the raw data generated by _c_use.sh_ and _h_use.sh_.  The output is written to the directory diagrams.

- _bldtab_: Create the table information from the raw data generated by _c_use.sh_ and _h_use.sh_. The output is written to the directory tables.

- _scripts_: Various general utility scripts.

- _diagrams_: Holds the .gra and .d files generated by the various _mkgra.sh_ scripts.

- _tables_: The subdirectory _tab_data_ holds the information generated by the various _mktab.sh_ scripts.  _updTABLE.sh_ combines the table information and a stripped down version of the books text.  The tools to generate a pdf file from this output are not part of the distribution.

- _thirdparty_: Various programs and scripts that might not be part of an installation.

- _config.files_: Sets environment variables used by many shell scripts
